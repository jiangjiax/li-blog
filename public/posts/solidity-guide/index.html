<!DOCTYPE html>
<html lang="zh" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="icon" type="image/x-icon" href="../../static/images/favicon.ico">
    <title>
        
            探索web3世界：Solidity 完全入门指南 - 鲤哥的博客 - 鲤哥的博客
        
    </title>
    
    
    <meta name="description" content="欢迎来到《探索 Web3 世界》系列文章，我是鲤哥。在这篇文章中，我将带你深入探索 Solidity——以太坊智能合约编程语言。无论你是编程新手还是有一定经验的开发者，这篇文章都将为你提供实用的知识和技巧，帮助你快速上手 Solidity。">
    
    <meta name="keywords" content="Solidity, 区块链, 智能合约, 以太坊">
    
    <meta name="author" content="蒋鲤">
    
    
    <meta name="static-path" content="../../static">
    
    
    <link rel="stylesheet" href="/static/css/styles.built.css">

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="alternate" type="application/rss+xml" 
        title="鲤哥的博客" 
        href="https://www.li-blog.top/feed.xml">
</head>
<body class="bg-white dark:bg-gray-900 min-h-full flex flex-col">
    
    <div id="stars-container" class="stars fixed inset-0 z-0 pointer-events-none"></div>

    
    
<header class="fixed top-0 w-full bg-stars-secondary/80 backdrop-blur-md z-50 border-b border-stars-accent/10">
    <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <a href="/" 
               class="text-xl font-bold text-stars-accent hover:text-stars-gold transition-all duration-300
                      relative group">
                <i class="fas fa-star mr-2 group-hover:rotate-180 transition-transform duration-500"></i>
                <span class="group-hover:tracking-wider transition-all duration-300">Stars</span>
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-stars-gold group-hover:w-full transition-all duration-300"></span>
            </a>
        </div>
        <div class="flex items-center space-x-6">
            <a href="/" class="nav-link group">
                <span class="relative">
                    首页
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-stars-accent group-hover:w-full transition-all duration-300"></span>
                </span>
            </a>
            <a href="/posts" class="nav-link group">
                <span class="relative">
                    文章
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-stars-accent group-hover:w-full transition-all duration-300"></span>
                </span>
            </a>
            <a href="/tags" class="nav-link group">
                <span class="relative">
                    标签云
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-stars-accent group-hover:w-full transition-all duration-300"></span>
                </span>
            </a>
        </div>
    </nav>
</header>


    
    <main class="flex-grow pt-20 relative z-10">
        
<article class="container mx-auto px-4 pt-2 pb-10">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
        
        <div class="lg:col-span-9">
            
            <header class="relative mb-6 lg:mb-10 p-6 lg:p-8 bg-stars-secondary/80 backdrop-blur-sm rounded-2xl border border-stars-accent/10
                         before:absolute before:inset-0 before:bg-gradient-to-br before:from-stars-accent/5 before:to-transparent before:rounded-2xl">
                
                
                <div class="relative mb-8">
                    <a href="#series-nav" 
                       class="inline-flex items-center gap-3 px-4 py-2 rounded-xl
                             bg-stars-primary/30 backdrop-blur-sm
                             border border-stars-accent/20 text-stars-accent
                             hover:bg-stars-accent/10 hover:scale-[1.02] 
                             transition-all duration-300 group">
                        <div class="flex items-center gap-2">
                            <span class="font-mono">探索Web3世界</span>
                        </div>
                        <span class="px-2 py-0.5 text-sm rounded-full bg-stars-accent/10 group-hover:bg-stars-accent/20">
                            Part 6
                        </span>
                        <i class="fas fa-chevron-down text-xs opacity-70 group-hover:translate-y-0.5 transition-transform"></i>
                    </a>
                </div>
                

                
                <h1 class="relative text-3xl sm:text-4xl lg:text-5xl font-bold text-stars-accent mb-4 lg:mb-6
                           leading-tight tracking-tight font-display">
                    探索web3世界：Solidity 完全入门指南
                </h1>

                
                
                <p class="relative text-base lg:text-lg text-stars-muted mb-6 lg:mb-8 leading-relaxed max-w-3xl">
                    欢迎来到《探索 Web3 世界》系列文章，我是鲤哥。在这篇文章中，我将带你深入探索 Solidity——以太坊智能合约编程语言。无论你是编程新手还是有一定经验的开发者，这篇文章都将为你提供实用的知识和技巧，帮助你快速上手 Solidity。
                </p>
                

                
                <div class="relative flex flex-col gap-4 sm:flex-row sm:items-center sm:gap-6">
                    
                    <div class="flex items-center gap-6 text-sm text-stars-muted">
                        <time class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-stars-primary/20">
                            <i class="far fa-calendar-alt"></i>
                            2025-01-24
                        </time>
                        <span class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-stars-primary/20">
                            <i class="far fa-clock"></i>
                            15 min read
                        </span>
                    </div>

                    
                    <div class="flex flex-wrap gap-2">
                        
                        <span class="px-3 py-1.5 text-sm rounded-lg
                                   bg-stars-primary/20 text-stars-muted
                                   border border-stars-accent/10
                                   hover:bg-stars-accent/5 hover:text-stars-accent
                                   transition-colors duration-300 cursor-default">
                            <i class="fas fa-tag text-xs mr-2 opacity-70"></i>
                            Solidity
                        </span>
                        
                        <span class="px-3 py-1.5 text-sm rounded-lg
                                   bg-stars-primary/20 text-stars-muted
                                   border border-stars-accent/10
                                   hover:bg-stars-accent/5 hover:text-stars-accent
                                   transition-colors duration-300 cursor-default">
                            <i class="fas fa-tag text-xs mr-2 opacity-70"></i>
                            区块链
                        </span>
                        
                        <span class="px-3 py-1.5 text-sm rounded-lg
                                   bg-stars-primary/20 text-stars-muted
                                   border border-stars-accent/10
                                   hover:bg-stars-accent/5 hover:text-stars-accent
                                   transition-colors duration-300 cursor-default">
                            <i class="fas fa-tag text-xs mr-2 opacity-70"></i>
                            智能合约
                        </span>
                        
                        <span class="px-3 py-1.5 text-sm rounded-lg
                                   bg-stars-primary/20 text-stars-muted
                                   border border-stars-accent/10
                                   hover:bg-stars-accent/5 hover:text-stars-accent
                                   transition-colors duration-300 cursor-default">
                            <i class="fas fa-tag text-xs mr-2 opacity-70"></i>
                            以太坊
                        </span>
                        
                    </div>
                </div>
            </header>

            
            <div class="relative group space-y-8 lg:space-y-12">
                
                <div class="bg-stars-secondary/80 backdrop-blur-sm rounded-2xl border border-stars-accent/10 overflow-hidden">
                    
                    
                    <div class="flex items-center justify-between gap-4 p-4 lg:p-6 border-b border-stars-accent/10
                                bg-gradient-to-r from-stars-accent/5 to-transparent">
                        <div class="flex items-center gap-3 text-stars-accent">
                            <i class="fas fa-shield-check"></i>
                            <span class="text-sm">此文章已上链验证</span>
                        </div>
                        <button onclick="scrollToVerification()" 
                                class="px-4 py-2 rounded-lg bg-stars-accent/10 text-stars-accent 
                                       hover:bg-stars-accent/20 transition-all duration-300">
                            <span class="flex items-center gap-2">
                                <span>查看 NFT 信息</span>
                            </span>
                        </button>
                    </div>
                    

                    
                    <div class="content p-5 sm:p-6 lg:p-8 prose prose-stars max-w-none">
                        <h2 id="heading">基础知识</h2>
<p>在开始编写智能合约之前，让我们先了解一些基础概念。就像盖房子需要先打好地基一样，这些基础知识将帮助你更好地理解和开发 Solidity 合约。</p>
<h3 id="-solidity">为什么选择 Solidity？</h3>
<p>想象一下，如果你想创建一个完全去中心化的应用，比如一个不需要中间商的二手交易平台，或者一个公平透明的抽奖系统，这时候就需要用到智能合约。而 Solidity 就是最流行的智能合约编程语言。</p>
<p>使用 Solidity，你可以：</p>
<ul>
<li>创建去中心化应用（DApps）：比如去中心化交易所、NFT 市场等</li>
<li>发行自己的代币：无论是 ERC-20 代币还是 NFT</li>
<li>构建 DeFi 协议：比如借贷平台、流动性挖矿等</li>
</ul>
<h3 id="remix-ide">开发环境：Remix IDE</h3>
<p>作为初学者，我强烈推荐使用 Remix IDE。它就像是智能合约开发的&quot;瑞士军刀&quot;，提供了你需要的一切工具。</p>
<p>为什么选择 Remix？</p>
<ul>
<li>无需安装：直接在浏览器中打开就能用</li>
<li>内置编译器：自动检查代码错误</li>
<li>模拟环境：可以免费测试合约</li>
<li>调试工具：帮你找出代码中的问题</li>
</ul>
<p>开始使用 Remix：</p>
<ol>
<li>打开浏览器，访问 <a href="https://remix.ethereum.org/">Remix 官方网站</a></li>
<li>第一次打开可能会看到很多文件和文件夹，不用担心，我们先把它们都删除，只保留 <code>contracts</code> 文件夹</li>
<li>在 <code>contracts</code> 文件夹中创建你的第一个合约文件，比如 <code>MyFirstContract.sol</code></li>
</ol>
<blockquote>
<p>小贴士：Remix 提供了多个主题，如果你喜欢深色模式，可以在设置中切换。长时间编码时，深色主题会让眼睛更舒服。</p>
</blockquote>
<h3 id="heading-1">数据存储位置</h3>
<p>在以太坊中，存储数据是需要付费的。就像租房子一样，存储空间越大，费用越高。所以理解不同的存储位置很重要：</p>
<h4 id="storage">Storage（永久存储）</h4>
<p>想象一下你在区块链上租了一个永久的仓库，所有放在这里的数据都会永久保存：</p>
<ul>
<li>优点：数据永久存在，任何时候都能访问</li>
<li>缺点：gas 费用高，因为要永久占用区块链空间</li>
</ul>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">StorageExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这些变量都存储在 storage 中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> name;           <span style="color:#75715e">// 比如用户名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> balance;       <span style="color:#75715e">// 账户余额
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> userBalances;  <span style="color:#75715e">// 用户余额映射
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _name) {
</span></span><span style="display:flex;"><span>        name <span style="color:#f92672">=</span> _name;    <span style="color:#75715e">// 将临时数据存入永久存储
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateName</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _newName) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        name <span style="color:#f92672">=</span> _newName; <span style="color:#75715e">// 同样是修改永久存储的数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h4 id="memory">Memory（临时存储）</h4>
<p>这就像是在函数运行时租用的临时工作空间：</p>
<ul>
<li>优点：gas 费用低，适合临时计算</li>
<li>缺点：函数执行完就消失了</li>
</ul>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">MemoryExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">concatenateStrings</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> str1, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> str2) 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 在 memory 中进行字符串拼接操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">string</span>(abi.encodePacked(str1, str2));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processArray</span>(<span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">memory</span> numbers) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">uint</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> numbers.length; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">+=</span> numbers[i];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sum;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="import-">import 导入</h3>
<p>在开发大型项目时，我们常常需要将代码分割成多个文件，以便更好的维护项目。import 语句允许我们导入其他文件中的合约、库或接口。</p>
<ol>
<li>导入整个文件：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;filename&#34;</span>;
</span></span></code></pre><ol start="2">
<li>导入特定部分：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#f92672">import</span> {symbol1, symbol2} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;filename&#34;</span>;
</span></span></code></pre><ol start="3">
<li>重命名导入的特定部分：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#f92672">import</span> {symbol1 <span style="color:#66d9ef">as</span> alias1, symbol2 <span style="color:#66d9ef">as</span> alias2} <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;filename&#34;</span>;
</span></span></code></pre><ol start="4">
<li>导入所有内容并指定命名空间：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> namespace <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;filename&#34;</span>;
</span></span></code></pre><p>在 import 语句中，路径可以是相对路径或绝对路径：</p>
<ul>
<li>相对路径：以 ./ 或 ../ 开头，表示相对于当前文件的路径。例如，import &quot;./Math.sol&quot;; 表示 Math.sol 文件与当前文件在同一目录下。</li>
<li>绝对路径：以 / 开头，表示从项目根目录开始的绝对路径。例如，import &quot;/contracts/Math.sol&quot;; 表示 Math.sol 文件位于项目根目录下的 contracts 文件夹中。</li>
</ul>
<h3 id="heading-2">版权声明</h3>
<p>每个 Solidity 文件都应该以一个特殊的注释开始：<code>// SPDX-License-Identifier: MIT</code></p>
<p>这行注释看起来很简单，但它非常重要。它告诉其他开发者如何合法地使用你的代码。就像在餐厅点菜时需要知道价格一样，其他开发者在使用你的代码时也需要知道使用条件。</p>
<p>SPDX（Software Package Data Exchange）是一个标准化的许可证标识符系统。常见的许可证类型包括：</p>
<ul>
<li><code>MIT</code>：最宽松的许可证之一，基本上说&quot;随便用，但别说是你写的&quot;</li>
<li><code>GPL-3.0</code>：要求任何使用该代码的项目也必须开源</li>
<li><code>UNLICENSED</code>：保留所有权利，通常用于私有代码</li>
<li><code>Apache-2.0</code>：类似 MIT，但提供专利授权条款</li>
</ul>
<p>如果不添加这个注释会怎样？</p>
<ul>
<li>其他开发者可能会因为不清楚使用条件而犹豫是否使用你的代码</li>
<li>可能会在未来遇到法律问题</li>
</ul>
<p>一个完整的示例：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">LicenseExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> LICENSE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MIT License - Feel free to use this code!&#34;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getTerms</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;You can copy, modify, and distribute this code freely&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="heading-3">版本声明</h3>
<p>在 Solidity 中，版本声明是非常重要的。它告诉编译器使用哪个版本的 Solidity 来编译你的代码。不同版本的 Solidity 可能有不同的特性和语法，所以明确指定版本可以避免很多潜在的问题。</p>
<p>版本声明使用 <code>pragma solidity</code> 关键字，后面跟着版本号。有几种常见的版本声明方式：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 1. 指定具体版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. 使用 ^ 符号表示向上兼容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 3. 指定版本范围
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">9</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 4. 使用 ~ 符号表示允许修订版本更新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">~</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span>;
</span></span></code></pre><p>让我们来理解这些版本声明的含义：</p>
<ol>
<li>
<p><code>pragma solidity 0.8.4;</code></p>
<ul>
<li>严格要求使用 0.8.4 版本</li>
<li>最严格的版本控制方式</li>
<li>适用于需要确保代码在特定版本下运行的情况</li>
</ul>
</li>
<li>
<p><code>pragma solidity ^0.8.4;</code></p>
<ul>
<li>允许使用 0.8.4 及以上的 0.8.x 版本</li>
<li>不允许使用 0.9.0 及以上版本</li>
<li>最常用的版本声明方式</li>
</ul>
</li>
<li>
<p><code>pragma solidity &gt;=0.8.0 &lt;0.9.0;</code></p>
<ul>
<li>明确指定版本范围</li>
<li>允许使用 0.8.0 到 0.9.0 之间的任何版本</li>
<li>适用于需要精确控制版本范围的情况</li>
</ul>
</li>
<li>
<p><code>pragma solidity ~0.8.0;</code></p>
<ul>
<li>允许修订版本更新（第三个数字的变化）</li>
<li>等同于 &gt;=0.8.0 &lt;0.9.0</li>
</ul>
</li>
</ol>
<h3 id="heading-4">定义合约</h3>
<p>使用 contract 关键字定义合约：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">MyContract</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 合约内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre><hr />
<h2 id="heading-5">数据类型和变量</h2>
<p>变量就像是一个个带标签的容器，用来存储各种类型的数据。就像超市里的货架一样，不同的货架用来存放不同类型的商品——你不会把牛奶放在蔬菜架上，对吧？</p>
<h3 id="heading-6">基本数据类型</h3>
<h4 id="bool">布尔型（bool）</h4>
<p>最简单的数据类型,只有 true 和 false 两个值。就像开关的开和关。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> isPaused;
</span></span></code></pre><h4 id="integer">整数类型（Integer）</h4>
<p>Solidity 提供了两种整数类型：</p>
<ul>
<li>int：可以表示正数和负数</li>
<li>uint：只能表示正数(无符号整数)</li>
</ul>
<p>这两种类型都有不同的大小变体,从8位到256位:</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">IntegerExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 用于存储用户年龄(0-255)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint8</span> <span style="color:#66d9ef">public</span> age;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 用于存储代币余额(可以很大)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint256</span> <span style="color:#66d9ef">public</span> balance;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 用于存储温度(可以为负)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int8</span> <span style="color:#66d9ef">public</span> temperature;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setAge</span>(<span style="color:#66d9ef">uint8</span> _age) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(_age <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">150</span>, <span style="color:#e6db74">&#34;Invalid age&#34;</span>);
</span></span><span style="display:flex;"><span>        age <span style="color:#f92672">=</span> _age;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 注意整数溢出的问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addToBalance</span>(<span style="color:#66d9ef">uint256</span> amount) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 在 0.8.0 版本之前需要手动检查溢出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        require(balance <span style="color:#f92672">+</span> amount <span style="color:#f92672">&gt;=</span> balance, <span style="color:#e6db74">&#34;Overflow&#34;</span>);
</span></span><span style="display:flex;"><span>        balance <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>小贴士：</p>
<ol>
<li>使用最小够用的整数类型可以节省 gas</li>
<li>uint8 虽然范围小，但在数组中和循环中反而会消耗更多 gas，这是为什么呢？</li>
</ol>
</blockquote>
<h4 id="-uint256--gas">为什么 uint256 有时候更省 gas？</h4>
<p>这听起来可能有点反直觉：明明 uint8 只用 8 位存储，而 uint256 用 256 位存储，为什么 uint8 反而会消耗更多 gas？</p>
<p>原因在于 EVM（以太坊虚拟机）的工作方式：</p>
<ol>
<li>EVM 的字长是 256 位，也就是说它天生就是为处理 256 位的数据优化的</li>
<li>当使用小于 256 位的类型时（比如 uint8），EVM 需要额外的操作来确保数值在正确的范围内：<br />
- 需要额外的掩码操作来清除高位<br />
- 需要额外的检查来确保数值不会超出范围</li>
</ol>
<p>实用建议：</p>
<ol>
<li>在状态变量中，如果确实只需要存储小范围的值（比如年龄），使用 uint8 可能更省存储空间</li>
<li>在函数内部的临时变量和循环计数器中，优先使用 uint256</li>
<li>在数组中，始终使用 uint256，因为 uint8[] 会导致更多的打包和解包操作</li>
</ol>
<h4 id="address">地址类型（Address）</h4>
<p>地址类型是以太坊的特色,用于存储账户地址。就像银行账号一样,每个地址都是独一无二的。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">AddressExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 合约拥有者地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 可以接收ETH的地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">public</span> treasury;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 用户余额映射
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> balances;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>() {
</span></span><span style="display:flex;"><span>        owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>        treasury <span style="color:#f92672">=</span> <span style="color:#66d9ef">payable</span>(msg.sender);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 向合约存款
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deposit</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">+=</span> msg.value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 从合约提款
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">withdraw</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(balances[msg.sender] <span style="color:#f92672">&gt;=</span> amount, <span style="color:#e6db74">&#34;Insufficient balance&#34;</span>);
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">-=</span> amount;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 注意: 先更新状态再转账,防止重入攻击
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">payable</span>(msg.sender).transfer(amount);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 检查地址是否为合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isContract</span>(<span style="color:#66d9ef">address</span> account) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> size;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> { size <span style="color:#f92672">:=</span> <span style="color:#a6e22e">extcodesize</span>(account) }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">return</span> size <span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h4 id="bytes">字节类型（Bytes）</h4>
<p>字节类型用于存储原始字节数据。就像计算机的DNA，可以存储任何类型的二进制数据。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 固定长度字节数组,用于存储哈希值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">bytes32</span> <span style="color:#66d9ef">public</span> documentHash;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 动态长度字节数组,用于存储可变长度数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">bytes</span> <span style="color:#66d9ef">public</span> dynamicData;
</span></span></code></pre><h3 id="heading-7">复杂数据类型</h3>
<h4 id="heading-8">数组</h4>
<p>数组是一种用于存储相同类型元素的数据结构。就像一排整齐的储物柜，每个柜子都用来存放相同类型的物品。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ArrayExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 固定长度数组 - 就像固定大小的停车场
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span>[<span style="color:#ae81ff">3</span>] <span style="color:#66d9ef">public</span> parkingLot <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 动态长度数组 - 就像可以随时扩建的仓库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">public</span> warehouse;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 添加商品到仓库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addItem</span>(<span style="color:#66d9ef">uint</span> item) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        warehouse.push(item);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 移除最后一个商品
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">removeLastItem</span>() <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(warehouse.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;Warehouse is empty&#34;</span>);
</span></span><span style="display:flex;"><span>        warehouse.pop();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 获取仓库中的商品数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getItemCount</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> warehouse.length;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 清空整个仓库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">clearWarehouse</span>() <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">delete</span> warehouse;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>注意事项：</p>
<ol>
<li>数组的长度不能超过 2^256-1</li>
<li>删除数组元素不会改变数组长度</li>
<li>memory 数组不能使用 push() 方法</li>
<li>访问超出数组范围的索引会导致异常</li>
</ol>
</blockquote>
<h4 id="heading-9">字符串</h4>
<p>字符串用于存储文本数据。在智能合约中，字符串常用于存储名称、描述、消息等文本信息。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">StringExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> name;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _name) {
</span></span><span style="display:flex;"><span>        name <span style="color:#f92672">=</span> _name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 字符串连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">greet</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">string</span>.concat(<span style="color:#e6db74">&#34;Hello, &#34;</span>, name, <span style="color:#e6db74">&#34;!&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 获取字符串长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getNameLength</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">bytes</span>(name).length;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 支持 unicode (比如中文、表情符号)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">greetInChinese</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> unicode<span style="color:#e6db74">&#34;你好，世界！👋&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>小贴士：</p>
<ol>
<li>字符串比较需要先转换为 bytes 再用 keccak256 计算哈希值</li>
<li>字符串操作相对耗费 gas，尽量使用较短的字符串</li>
<li>如果只是存储固定的短文本，考虑使用 bytes32 代替 string</li>
</ol>
</blockquote>
<h4 id="heading-10">映射</h4>
<p>mapping 就像一个神奇的字典，你给它一个关键词(key)，它就能立即找到对应的内容(value)。非常适合需要快速查找的场景，比如用户余额、投票记录等。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">VotingSystem</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 记录每个地址的投票权重
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> voteWeight;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 记录每个提案的得票数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> proposalVotes;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 记录每个地址对每个提案的投票情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">bool</span>)) <span style="color:#66d9ef">public</span> hasVoted;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 分配投票权重
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">assignVoteWeight</span>(<span style="color:#66d9ef">address</span> voter, <span style="color:#66d9ef">uint</span> weight) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        voteWeight[voter] <span style="color:#f92672">=</span> weight;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 投票
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">vote</span>(<span style="color:#66d9ef">uint</span> proposalId) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(<span style="color:#f92672">!</span>hasVoted[msg.sender][proposalId], <span style="color:#e6db74">&#34;Already voted&#34;</span>);
</span></span><span style="display:flex;"><span>        require(voteWeight[msg.sender] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;No voting rights&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        proposalVotes[proposalId] <span style="color:#f92672">+=</span> voteWeight[msg.sender];
</span></span><span style="display:flex;"><span>        hasVoted[msg.sender][proposalId] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="heading-11">常量</h3>
<p>在 Solidity 中，常量就像是写在石头上的数字，一旦确定就永远不会改变。使用常量不仅可以让代码更安全，还能节省 gas 费用。Solidity 提供了两种类型的常量：constant（编译时常量）和 immutable（不可变量）。</p>
<h4 id="constant">constant</h4>
<p>constant 常量必须在声明时就确定它的值，就像把数字刻在石头上一样，之后就再也改不了了。它通常用于定义一些固定的配置值，比如：</p>
<ul>
<li>最大供应量</li>
<li>费率百分比</li>
<li>时间间隔</li>
<li>合约版本号</li>
</ul>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">TokenConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 代币的基本配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MyToken&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> SYMBOL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MTK&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> DECIMALS <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> TOTAL_SUPPLY <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">**</span><span style="color:#ae81ff">18</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 费率设置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> TRANSFER_FEE <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;  <span style="color:#75715e">// 0.1%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> MAX_FEE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;      <span style="color:#75715e">// 1%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 时间常量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> LOCK_PERIOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">365</span> <span style="color:#66d9ef">days</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> MIN_STAKE_TIME <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span> <span style="color:#66d9ef">days</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>使用建议：</p>
<ol>
<li>对于永远不会改变的配置值，优先使用 constant</li>
<li>constant 变量名通常使用大写字母</li>
<li>复杂的表达式也可以用 constant，只要能在编译时计算出结果</li>
</ol>
</blockquote>
<h4 id="immutable">immutable</h4>
<p>immutable（不可变量）是一种特殊的常量，它的值可以在合约部署时设置，但之后就不能再改变了。这非常适合那些需要在部署时才能确定的值，比如：</p>
<ul>
<li>合约所有者地址</li>
<li>初始时间戳</li>
<li>其他合约的地址</li>
<li>初始配置参数</li>
</ul>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">TokenSale</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 在部署时需要确定的关键地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> owner;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> tokenAddress;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> treasuryWallet;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 在部署时需要确定的参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> startTime;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> pricePerToken;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">immutable</span> maxBuyPerUser;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> _token,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> _treasury,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> _price,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> _maxBuy
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>        tokenAddress <span style="color:#f92672">=</span> _token;
</span></span><span style="display:flex;"><span>        treasuryWallet <span style="color:#f92672">=</span> _treasury;
</span></span><span style="display:flex;"><span>        startTime <span style="color:#f92672">=</span> block.timestamp;
</span></span><span style="display:flex;"><span>        pricePerToken <span style="color:#f92672">=</span> _price;
</span></span><span style="display:flex;"><span>        maxBuyPerUser <span style="color:#f92672">=</span> _maxBuy;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 其他函数...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre><blockquote>
<p>重要提示：</p>
<ol>
<li>immutable 变量只能在构造函数中赋值一次</li>
<li>赋值后就不能再修改</li>
<li>适合存储部署时才能确定的配置</li>
<li>比普通状态变量更省 gas</li>
</ol>
</blockquote>
<h4 id="constant-vs-immutable-">constant vs immutable 如何选择？</h4>
<ol>
<li>
<p>如果值在写代码时就能确定，使用 constant</p>
<ul>
<li>代币小数位数</li>
<li>最大供应量</li>
<li>固定的时间间隔</li>
</ul>
</li>
<li>
<p>如果值需要在部署时才能确定，使用 immutable</p>
<ul>
<li>部署时间</li>
<li>合约地址</li>
<li>初始所有者</li>
<li>其他依赖部署环境的参数</li>
</ul>
</li>
</ol>
<hr />
<h2 id="heading-12">函数</h2>
<p>函数就像是合约的&quot;动作&quot;部分——如果说状态变量是合约的&quot;记忆&quot;，那么函数就是合约的&quot;行为&quot;。每个函数都有特定的功能，就像餐厅里不同的工作人员各司其职：有人负责接待，有人负责收银，有人负责烹饪。</p>
<h3 id="heading-13">函数定义</h3>
<p>让我们通过一个简单的代币合约来了解不同类型的函数：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">TokenContract</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 状态变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> balances;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 构造函数：合约部署时自动执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">constructor</span>() {
</span></span><span style="display:flex;"><span>        owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000</span>; <span style="color:#75715e">// 初始发行100万代币
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 基础转账函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(balances[msg.sender] <span style="color:#f92672">&gt;=</span> amount, <span style="color:#e6db74">&#34;Insufficient balance&#34;</span>);
</span></span><span style="display:flex;"><span>        require(to <span style="color:#f92672">!=</span> <span style="color:#66d9ef">address</span>(<span style="color:#ae81ff">0</span>), <span style="color:#e6db74">&#34;Invalid recipient&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">-=</span> amount;
</span></span><span style="display:flex;"><span>        balances[to] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 触发转账事件（后面会讲到事件）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        emit Transfer(msg.sender, to, amount);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 只读函数：查询余额
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getBalance</span>(<span style="color:#66d9ef">address</span> account) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> balances[account];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 纯函数：计算代币数量（比如根据ETH计算可以买多少代币）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateTokenAmount</span>(<span style="color:#66d9ef">uint</span> ethAmount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1 ETH = 1000 tokens
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> ethAmount <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 接收ETH的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    receive() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 当合约收到ETH时自动执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint</span> tokenAmount <span style="color:#f92672">=</span> calculateTokenAmount(msg.value);
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">+=</span> tokenAmount;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 管理员函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mint</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(msg.sender <span style="color:#f92672">==</span> owner, <span style="color:#e6db74">&#34;Only owner can mint&#34;</span>);
</span></span><span style="display:flex;"><span>        balances[to] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="heading-14">函数可见性</h3>
<p>函数的可见性就像是给函数设置&quot;访问权限&quot;。就像一个建筑物，有的区域对所有人开放，有的只对员工开放，有的只对管理员开放。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">AccessControl</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. public：对所有人开放，就像商场的大门
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">publicFunction</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Anyone can call me&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. private：只能从合约内部调用，就像员工休息室
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">privateFunction</span>() <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Only this contract can call me&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. internal：只能从当前合约和子合约调用，就像员工及其家属专用区
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">internalFunction</span>() <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;This contract and its children can call me&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 4. external：只能从外部调用，不能从合约内部调用，就像对外服务窗口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">externalFunction</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Only external calls allowed&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 测试函数可见性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">testVisibility</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 可以调用 public 函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        this.publicFunction();  <span style="color:#75715e">// 使用 this 是外部调用，消耗更多 gas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        publicFunction();       <span style="color:#75715e">// 内部调用，更省 gas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 可以调用 private 函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        privateFunction();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 可以调用 internal 函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        internalFunction();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 不能直接调用 external 函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// externalFunction();  // 这行会编译错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        this.externalFunction();  <span style="color:#75715e">// 必须通过 this 调用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>小贴士：</p>
<ol>
<li>public 函数会自动生成一个同名的 getter 函数</li>
<li>external 函数比 public 函数更省 gas（当从外部调用时）</li>
<li>如果函数只会从外部调用，建议使用 external</li>
<li>如果不确定用哪个，public 是最安全的选择</li>
</ol>
<h3 id="heading-15">函数修饰符</h3>
<p>函数修饰符用于声明函数的特性，就像给函数贴上不同的标签，告诉编译器这个函数有什么特点：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ModifierExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. view：可以读取状态，但不能修改状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCounter</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> counter;  <span style="color:#75715e">// 只读取状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. pure：不能读取也不能修改状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">uint</span> a, <span style="color:#66d9ef">uint</span> b) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b;  <span style="color:#75715e">// 纯计算
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. payable：可以接收 ETH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deposit</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        counter <span style="color:#f92672">+=</span> msg.value;  <span style="color:#75715e">// 记录存入的 ETH 数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 4. 不带修饰符：可以修改状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">increment</span>() <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        counter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;  <span style="color:#75715e">// 修改状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>小贴士：</p>
<ol>
<li>优先使用 pure 和 view，因为它们不消耗 gas（从外部调用时）</li>
<li>如果函数需要修改状态，就不要加这些修饰符</li>
<li>payable 函数要特别注意安全性，因为它们可以接收 ETH</li>
</ol>
<h3 id="heading-16">特殊函数</h3>
<p>Solidity 提供了一些特殊函数，它们在特定情况下会自动执行：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">SpecialFunctions</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Received</span>(<span style="color:#66d9ef">address</span> sender, <span style="color:#66d9ef">uint</span> amount);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">FallbackCalled</span>(<span style="color:#66d9ef">address</span> sender, <span style="color:#66d9ef">bytes</span> data);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. 构造函数：只在合约部署时执行一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">constructor</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. receive 函数：当合约收到 ETH 时自动执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    receive() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        emit Received(msg.sender, msg.value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. fallback 函数：当调用的函数不存在时执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    fallback() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        emit FallbackCalled(msg.sender, msg.data);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>注意事项：</p>
<ol>
<li>一个合约只能有一个 constructor</li>
<li>receive 函数必须是 external payable</li>
<li>fallback 函数会在以下情况被调用：
<ul>
<li>调用不存在的函数</li>
<li>直接发送 ETH 但没有 receive 函数</li>
<li>发送的数据不是有效的函数调用</li>
</ul>
</li>
</ol>
<h3 id="heading-17">函数重载</h3>
<p>Solidity 支持函数重载，这意味着你可以定义多个同名但参数不同的函数。就像餐厅的厨师可以用不同的配料做出同名的菜品：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">FunctionOverloading</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 转账相关函数的重载示例
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. 基础转账
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... 基础转账逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. 带备注的转账
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> note) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... 带备注的转账逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        emit Transfer(msg.sender, to, amount, note);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. 批量转账
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span>[] <span style="color:#66d9ef">memory</span> to, <span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">memory</span> amounts) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(to.length <span style="color:#f92672">==</span> amounts.length, <span style="color:#e6db74">&#34;Arrays length mismatch&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... 批量转账逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>注意事项：</p>
<ol>
<li>重载函数必须有不同的参数类型</li>
<li>仅返回值不同不构成重载</li>
<li>参数名称不同不构成重载</li>
</ol>
<hr />
<h2 id="heading-18">程序控制</h2>
<p>就像指挥交通的红绿灯，程序控制结构帮助我们管理代码的执行流程。Solidity 提供了几种基本的控制结构，让我们通过一个 NFT 交易市场的例子来理解它们：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">NFTMarketplace</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 状态变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> nftPrices;      <span style="color:#75715e">// NFT 价格
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">address</span>) <span style="color:#66d9ef">public</span> nftOwners;   <span style="color:#75715e">// NFT 所有者
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">bool</span>) <span style="color:#66d9ef">public</span> isListed;       <span style="color:#75715e">// NFT 是否在售
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> platformFee <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>;                <span style="color:#75715e">// 平台费率（2.5%）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 条件控制示例：上架 NFT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">listNFT</span>(<span style="color:#66d9ef">uint</span> tokenId, <span style="color:#66d9ef">uint</span> price) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1. if-else：基本条件判断
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (nftOwners[tokenId] <span style="color:#f92672">!=</span> msg.sender) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Not the owner&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 2. 多重条件：检查价格和状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (price <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Price cannot be zero&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (isListed[tokenId]) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Already listed&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (price <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">ether</span>) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Price too high&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 设置 NFT 信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        nftPrices[tokenId] <span style="color:#f92672">=</span> price;
</span></span><span style="display:flex;"><span>        isListed[tokenId] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 循环示例：批量处理 NFT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">batchList</span>(<span style="color:#66d9ef">uint</span>[] calldata tokenIds, <span style="color:#66d9ef">uint</span>[] calldata prices) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3. for 循环：批量上架
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        require(tokenIds.length <span style="color:#f92672">==</span> prices.length, <span style="color:#e6db74">&#34;Length mismatch&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">uint</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> tokenIds.length; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 这里可以调用 listNFT，但直接处理更省 gas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">uint</span> tokenId <span style="color:#f92672">=</span> tokenIds[i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">uint</span> price <span style="color:#f92672">=</span> prices[i];
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            require(nftOwners[tokenId] <span style="color:#f92672">==</span> msg.sender, <span style="color:#e6db74">&#34;Not the owner&#34;</span>);
</span></span><span style="display:flex;"><span>            require(price <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;Invalid price&#34;</span>);
</span></span><span style="display:flex;"><span>            require(<span style="color:#f92672">!</span>isListed[tokenId], <span style="color:#e6db74">&#34;Already listed&#34;</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            nftPrices[tokenId] <span style="color:#f92672">=</span> price;
</span></span><span style="display:flex;"><span>            isListed[tokenId] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// while 循环示例：查找第一个可购买的 NFT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">findFirstListedNFT</span>(<span style="color:#66d9ef">uint</span> startId, <span style="color:#66d9ef">uint</span> endId) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span> foundId, <span style="color:#66d9ef">bool</span> found) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4. while 循环：在范围内搜索
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint</span> currentId <span style="color:#f92672">=</span> startId;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (currentId <span style="color:#f92672">&lt;=</span> endId) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (isListed[currentId]) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> (currentId, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            currentId<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do-while 循环示例：拍卖倒计时
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startAuction</span>(<span style="color:#66d9ef">uint</span> tokenId, <span style="color:#66d9ef">uint</span> duration) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(isListed[tokenId], <span style="color:#e6db74">&#34;NFT not listed&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 5. do-while：至少执行一次的循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint</span> timeLeft <span style="color:#f92672">=</span> duration;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 在实际场景中，这里会等待一段时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            timeLeft<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 检查是否有新的出价
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (hasNewBid(tokenId)) {
</span></span><span style="display:flex;"><span>                timeLeft <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">minutes</span>; <span style="color:#75715e">// 重置倒计时
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">while</span> (timeLeft <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 拍卖结束，处理结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        finalizeAuction(tokenId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 辅助函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">hasNewBid</span>(<span style="color:#66d9ef">uint</span> tokenId) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 实现检查新出价的逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">finalizeAuction</span>(<span style="color:#66d9ef">uint</span> tokenId) <span style="color:#66d9ef">internal</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 实现拍卖结束的逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="heading-19">错误处理最佳实践</h3>
<p>在使用控制结构时，合理的错误处理非常重要：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ErrorHandling</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. 使用 require 进行输入验证
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validateInput</span>(<span style="color:#66d9ef">uint</span> value) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(value <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;Value must be positive&#34;</span>);
</span></span><span style="display:flex;"><span>        require(value <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">100</span>, <span style="color:#e6db74">&#34;Value must be &lt;= 100&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. 使用 if-revert 处理复杂条件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">complexValidation</span>(<span style="color:#66d9ef">uint</span> value, <span style="color:#66d9ef">bool</span> condition) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (value <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>condition) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Invalid input&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (value <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">&amp;&amp;</span> condition) {
</span></span><span style="display:flex;"><span>            revert(<span style="color:#e6db74">&#34;Value too high with condition&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. 使用 try-catch 处理外部调用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">safeExternalCall</span>(<span style="color:#66d9ef">address</span> target) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> ITarget(target).someFunction() <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span> success) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> success;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> Error(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> reason) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 处理错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            emit ErrorCaught(reason);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><hr />
<h2 id="heading-20">面向对象特性</h2>
<p>Solidity 作为一门面向对象的语言，提供了丰富的面向对象特性。就像乐高积木一样，我们可以通过这些特性来组装出复杂的智能合约系统。让我们通过一个 DeFi 借贷平台的例子来理解这些概念：</p>
<h3 id="heading-21">继承</h3>
<p>继承就像是合约的&quot;基因传递&quot;——子合约可以继承父合约的所有特性，并且可以添加新的功能或修改现有功能。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 基础代币合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Token</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> balances;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">public</span> symbol;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8</span> <span style="color:#66d9ef">public</span> decimals;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Transfer</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">indexed</span> <span style="color:#66d9ef">from</span>, <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">indexed</span> to, <span style="color:#66d9ef">uint</span> amount);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _name, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _symbol) {
</span></span><span style="display:flex;"><span>        name <span style="color:#f92672">=</span> _name;
</span></span><span style="display:flex;"><span>        symbol <span style="color:#f92672">=</span> _symbol;
</span></span><span style="display:flex;"><span>        decimals <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(balances[msg.sender] <span style="color:#f92672">&gt;=</span> amount, <span style="color:#e6db74">&#34;Insufficient balance&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">-=</span> amount;
</span></span><span style="display:flex;"><span>        balances[to] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        emit Transfer(msg.sender, to, amount);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 可暂停的代币合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">PausableToken</span> <span style="color:#66d9ef">is</span> Token {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> paused;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> admin;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _name, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _symbol) 
</span></span><span style="display:flex;"><span>        Token(_name, _symbol) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        admin <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 重写转账函数，添加暂停检查
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> to, <span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(<span style="color:#f92672">!</span>paused, <span style="color:#e6db74">&#34;Token transfers are paused&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> super.transfer(to, amount);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 管理员功能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">togglePause</span>() <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        require(msg.sender <span style="color:#f92672">==</span> admin, <span style="color:#e6db74">&#34;Only admin&#34;</span>);
</span></span><span style="display:flex;"><span>        paused <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>paused;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 可借贷的代币合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">LendableToken</span> <span style="color:#66d9ef">is</span> PausableToken {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> borrowed;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> interestRate <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>; <span style="color:#75715e">// 5% APR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _name, <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _symbol) 
</span></span><span style="display:flex;"><span>        PausableToken(_name, _symbol) 
</span></span><span style="display:flex;"><span>    {}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 借款功能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">borrow</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        require(<span style="color:#f92672">!</span>paused, <span style="color:#e6db74">&#34;Lending is paused&#34;</span>);
</span></span><span style="display:flex;"><span>        require(<span style="color:#66d9ef">address</span>(this).balance <span style="color:#f92672">&gt;=</span> amount, <span style="color:#e6db74">&#34;Insufficient liquidity&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        borrowed[msg.sender] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>        balances[msg.sender] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        emit Transfer(<span style="color:#66d9ef">address</span>(this), msg.sender, amount);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 计算利息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateInterest</span>(<span style="color:#66d9ef">address</span> user) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (borrowed[user] <span style="color:#f92672">*</span> interestRate) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>继承的最佳实践：</p>
<ol>
<li>使用 is 关键字来继承多个合约</li>
<li>使用 virtual 和 override 关键字管理函数重写</li>
<li>使用 super 关键字调用父合约函数</li>
<li>注意继承顺序（从最基础到最特殊）</li>
</ol>
</blockquote>
<h3 id="heading-22">接口</h3>
<p>接口就像是合约之间的&quot;通信协议&quot;，它定义了合约应该实现哪些功能，但不关心这些功能具体怎么实现。就像餐厅的菜单一样，告诉你有什么菜，但不会告诉你怎么做这些菜。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 定义借贷协议接口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ILendingProtocol</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 存款
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deposit</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 借款
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">borrow</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 还款
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">repay</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 查询利率
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getInterestRate</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 查询可借额度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getBorrowLimit</span>(<span style="color:#66d9ef">address</span> user) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 必须定义的事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Deposit</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">indexed</span> user, <span style="color:#66d9ef">uint</span> amount);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Borrow</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">indexed</span> user, <span style="color:#66d9ef">uint</span> amount);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">event</span> <span style="color:#a6e22e">Repay</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">indexed</span> user, <span style="color:#66d9ef">uint</span> amount);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 实现借贷协议
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">SimpleLending</span> <span style="color:#66d9ef">is</span> ILendingProtocol {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> deposits;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> borrows;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">constant</span> BORROW_FACTOR <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>; <span style="color:#75715e">// 80% 抵押率
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deposit</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        deposits[msg.sender] <span style="color:#f92672">+=</span> msg.value;
</span></span><span style="display:flex;"><span>        emit Deposit(msg.sender, msg.value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">borrow</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> borrowLimit <span style="color:#f92672">=</span> getBorrowLimit(msg.sender);
</span></span><span style="display:flex;"><span>        require(amount <span style="color:#f92672">&lt;=</span> borrowLimit, <span style="color:#e6db74">&#34;Exceeds borrow limit&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        borrows[msg.sender] <span style="color:#f92672">+=</span> amount;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">payable</span>(msg.sender).transfer(amount);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        emit Borrow(msg.sender, amount);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">repay</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">override</span> {
</span></span><span style="display:flex;"><span>        require(borrows[msg.sender] <span style="color:#f92672">&gt;=</span> msg.value, <span style="color:#e6db74">&#34;Repay amount too high&#34;</span>);
</span></span><span style="display:flex;"><span>        borrows[msg.sender] <span style="color:#f92672">-=</span> msg.value;
</span></span><span style="display:flex;"><span>        emit Repay(msg.sender, msg.value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getInterestRate</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">5</span>; <span style="color:#75715e">// 5% APR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getBorrowLimit</span>(<span style="color:#66d9ef">address</span> user) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (deposits[user] <span style="color:#f92672">*</span> BORROW_FACTOR) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>接口使用技巧：</p>
<ol>
<li>接口中的所有函数必须是 external</li>
<li>接口不能定义构造函数</li>
<li>接口不能定义状态变量</li>
<li>接口可以定义事件</li>
</ol>
</blockquote>
<h3 id="heading-23">抽象合约</h3>
<p>抽象合约就像是一个半成品的合约模板，它可以包含已实现的函数，也可以包含未实现的函数。继承它的合约必须实现所有未实现的函数。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 抽象的收益率合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">YieldStrategy</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 已实现的函数：计算基础收益
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateBaseYield</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> amount <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>; <span style="color:#75715e">// 5% 基础收益
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 未实现的函数：计算额外收益
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateBonus</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 未实现的函数：获取策略名称
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getStrategyName</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 实现具体的收益率策略
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">StakingStrategy</span> <span style="color:#66d9ef">is</span> YieldStrategy {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 实现计算额外收益的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateBonus</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 根据质押金额提供额外奖励
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (amount <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">ether</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> amount <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>; <span style="color:#75715e">// 额外 2%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 实现获取策略名称的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getStrategyName</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;High Yield Staking Strategy&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 计算总收益
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateTotalYield</span>(<span style="color:#66d9ef">uint</span> amount) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> calculateBaseYield(amount) <span style="color:#f92672">+</span> calculateBonus(amount);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>抽象合约的使用场景：</p>
<ol>
<li>定义通用的业务逻辑框架</li>
<li>强制子合约实现特定功能</li>
<li>提供可重用的基础实现</li>
<li>实现模板方法设计模式</li>
</ol>
</blockquote>
<hr />
<h2 id="heading-24">高级特性</h2>
<p>让我们通过构建一个 DeFi 收益聚合器(Yield Aggregator)来学习 Solidity 的高级特性。这个项目会帮助用户自动在不同的 DeFi 协议间切换，以获取最佳收益。</p>
<h3 id="modifier">修饰符（modifier）</h3>
<p>修饰符就像是函数的&quot;保镖&quot;，它们在函数执行前后进行各种检查和处理。比如检查调用者是否有权限、合约是否处于正确状态等。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">YieldAggregator</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> admin;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">public</span> paused;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) <span style="color:#66d9ef">public</span> userDeposits;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> totalDeposits;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> minDepositAmount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ether</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 基础修饰符：检查管理员权限
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyAdmin</span>() {
</span></span><span style="display:flex;"><span>        require(msg.sender <span style="color:#f92672">==</span> admin, <span style="color:#e6db74">&#34;Not authorized&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">_</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 带参数的修饰符：检查最小金额
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">minAmount</span>(<span style="color:#66d9ef">uint</span> amount) {
</span></span><span style="display:flex;"><span>        require(amount <span style="color:#f92672">&gt;=</span> minDepositAmount, <span style="color:#e6db74">&#34;Amount too small&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">_</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 状态检查修饰符：检查合约是否暂停
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">whenNotPaused</span>() {
</span></span><span style="display:flex;"><span>        require(<span style="color:#f92672">!</span>paused, <span style="color:#e6db74">&#34;Contract is paused&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">_</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 复合使用修饰符
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deposit</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> 
</span></span><span style="display:flex;"><span>        whenNotPaused 
</span></span><span style="display:flex;"><span>        minAmount(msg.value) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        userDeposits[msg.sender] <span style="color:#f92672">+=</span> msg.value;
</span></span><span style="display:flex;"><span>        totalDeposits <span style="color:#f92672">+=</span> msg.value;
</span></span><span style="display:flex;"><span>        emit Deposit(msg.sender, msg.value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>修饰符使用技巧：</p>
<ol>
<li>将常用的检查逻辑封装成修饰符</li>
<li>修饰符可以组合使用</li>
<li>注意修饰符的执行顺序</li>
<li>避免在修饰符中执行复杂的业务逻辑</li>
</ol>
</blockquote>
<h3 id="event">事件（event）</h3>
<p>事件就像是区块链上的&quot;日志系统&quot;，它会永久记录在区块链上。与消息队列（如 Kafka）不同，事件一旦被记录就不可更改，也不需要确认接收。</p>
<h4 id="heading-25">事件的存储位置</h4>
<p>事件数据存储在区块链的特殊数据结构中，称为&quot;日志&quot;（Logs）：</p>
<ul>
<li>日志数据不能被智能合约访问</li>
<li>日志数据存储成本比状态变量低得多</li>
<li>日志数据会永久保存在区块链上</li>
</ul>
<h4 id="heading-26">事件的接收方式</h4>
<ol>
<li>前端应用可以通过 Web3 库监听事件：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 监听所有 Transfer 事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">Transfer</span>()
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;data&#39;</span>, <span style="color:#a6e22e">event</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;转账发生：&#39;</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">returnValues</span>.<span style="color:#a6e22e">from</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">returnValues</span>.<span style="color:#a6e22e">to</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">returnValues</span>.<span style="color:#a6e22e">amount</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, <span style="color:#a6e22e">error</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">error</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 只监听特定地址的转账
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">Transfer</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">filter</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">userAddress</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre><ol start="2">
<li>后端服务可以通过 RPC 节点查询历史事件：</li>
</ol>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 获取过去的事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">getPastEvents</span>(<span style="color:#e6db74">&#39;Transfer&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fromBlock</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">toBlock</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;latest&#39;</span>
</span></span><span style="display:flex;"><span>});
</span></span></code></pre><h4 id="heading-27">事件的特点</h4>
<ol>
<li>
<p>不可恢复性：</p>
<ul>
<li>事件一旦发出就无法撤回</li>
<li>如果交易回滚，事件也不会记录</li>
<li>没有原生的重试机制，因为这是日志而不是消息队列</li>
</ul>
</li>
<li>
<p>永久存储：</p>
<ul>
<li>事件数据会永久保存在区块链上</li>
<li>即使没有人监听，数据也不会丢失</li>
<li>任何时候都可以查询历史事件</li>
</ul>
</li>
<li>
<p>索引特性：</p>
<ul>
<li>indexed 参数会创建索引方便快速查询</li>
<li>最多可以有 3 个 indexed 参数</li>
<li>非索引参数可以存储任意长度的数据</li>
</ul>
</li>
</ol>
<h3 id="heading-28">事件重放</h3>
<p>虽然事件本身没有重试机制，但我们可以通过读取历史日志来&quot;重放&quot;错过的事件：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 1. 记录上次处理到的区块
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">lastProcessedBlock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getLastProcessedBlock</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. 获取错过的事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">missedEvents</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">getPastEvents</span>(<span style="color:#e6db74">&#39;Transfer&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fromBlock</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">lastProcessedBlock</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">toBlock</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;latest&#39;</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 3. 按顺序处理每个事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">event</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">missedEvents</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">processEvent</span>(<span style="color:#a6e22e">event</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 更新处理进度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">updateLastProcessedBlock</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">blockNumber</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;处理事件失败:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 错误处理...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>事件重放注意事项：</p>
<ol>
<li>事件处理要做到幂等（重复处理不会产生副作用）</li>
<li>要记录处理进度，避免重复处理</li>
<li>考虑区块重组的情况，可能需要回滚一些区块的处理</li>
<li>大量事件重放要考虑性能问题</li>
</ol>
</blockquote>
<h3 id="library">库（Library）</h3>
<p>库就像是一个工具箱，里面放着各种可重用的工具函数。它可以帮我们节省 gas，也能让代码更整洁。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 数学计算库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">library</span> YieldMath {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 计算年化收益率
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateAPY</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> yield, 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> principal, 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> timeInSeconds
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (yield <span style="color:#f92672">*</span> <span style="color:#ae81ff">365</span> <span style="color:#66d9ef">days</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>) <span style="color:#f92672">/</span> (principal <span style="color:#f92672">*</span> timeInSeconds);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 计算复利
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">compoundInterest</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> principal,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> ratePerYear,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> timeInYears
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 简化的复利计算
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint</span> rate <span style="color:#f92672">=</span> ratePerYear <span style="color:#f92672">+</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> result <span style="color:#f92672">=</span> principal;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">uint</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> timeInYears;) {
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> (result <span style="color:#f92672">*</span> rate) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">unchecked</span> { <span style="color:#f92672">++</span>i; }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 安全检查库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">library</span> SafetyChecks {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 检查地址是否为合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isContract</span>(<span style="color:#66d9ef">address</span> account) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> size;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> { size <span style="color:#f92672">:=</span> <span style="color:#a6e22e">extcodesize</span>(account) }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">return</span> size <span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 检查数组长度是否匹配
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">requireArrayLengths</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">memory</span> arr1, 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">memory</span> arr2
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">pure</span> {
</span></span><span style="display:flex;"><span>        require(arr1.length <span style="color:#f92672">==</span> arr2.length, <span style="color:#e6db74">&#34;Array lengths mismatch&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 使用库的合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">YieldAggregator</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">using</span> YieldMath <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">uint</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">using</span> SafetyChecks <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">address</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calculateUserYield</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> user,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> depositAmount,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> duration
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        require(user.isContract() <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;User cannot be a contract&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> yield <span style="color:#f92672">=</span> getYield(user);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> apy <span style="color:#f92672">=</span> YieldMath.calculateAPY(yield, depositAmount, duration);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> YieldMath.compoundInterest(
</span></span><span style="display:flex;"><span>            depositAmount,
</span></span><span style="display:flex;"><span>            apy,
</span></span><span style="display:flex;"><span>            duration <span style="color:#f92672">/</span> <span style="color:#ae81ff">365</span> <span style="color:#66d9ef">days</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>库的最佳实践：</p>
<ol>
<li>将通用的纯函数放入库中</li>
<li>使用 using for 语法简化调用</li>
<li>库函数应该是无状态的</li>
<li>注意库的部署和链接成本</li>
</ol>
</blockquote>
<h3 id="unchecked">屏蔽溢出检查（unchecked）</h3>
<p>Solidity 中的 unchecked 用于关闭作用域内的整数溢出检查。可以节省 gas 消耗。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Unchecked</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sum</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">uint</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1000</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">unchecked</span> {
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">+=</span> i;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>unchecked 对于大括号 {} 中的代码计算，不再检查整数是否溢出，从而提高计算效率，节省 gas。</p>
<p>上面的代码，如果不使用 unchecked，gas 消耗为 381360。</p>
<p>如果使用了 unchecked，那么 gas 消耗为 193360，节省了差不多一半的 gas 消耗。</p>
<p>unchecked 通常在大量计算的情况下使用，效果才会明显。如果只是执行一两次的计算，就无需使用了。</p>
<p>需要注意是，unchecked 不可以滥用，因为它屏蔽掉了整数溢出检查，会带来一定的安全风险。未经检查的整数运算可能会导致不可预料的结果，甚至可能导致合约漏洞或攻击。因此，在使用 unchecked 时，需要确保你完全理解代码的上下文，并能够确保在这些情况下不会发生溢出。</p>
<h3 id="heading-29">委托调用</h3>
<p>delegatecall 是一种特殊的消息调用，它允许一个合约执行另一个合约的代码，但是在当前合约的上下文中执行。这就像是&quot;借用&quot;别人的代码，但在自己的&quot;地盘&quot;上运行。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// 逻辑合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">LogicContract</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> value;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> sender;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> amount;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setValue</span>(<span style="color:#66d9ef">uint</span> _value) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">=</span> _value;
</span></span><span style="display:flex;"><span>        sender <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>        amount <span style="color:#f92672">=</span> msg.value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 代理合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">ProxyContract</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> value;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> sender;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> amount;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">executeLogic</span>(<span style="color:#66d9ef">address</span> _logic, <span style="color:#66d9ef">bytes</span> <span style="color:#66d9ef">memory</span> _data) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 使用 delegatecall 调用逻辑合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        (<span style="color:#66d9ef">bool</span> success, ) <span style="color:#f92672">=</span> _logic.delegatecall(_data);
</span></span><span style="display:flex;"><span>        require(success, <span style="color:#e6db74">&#34;Delegatecall failed&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><blockquote>
<p>使用 delegatecall 需要注意：</p>
<ol>
<li>状态变量的布局必须完全相同</li>
<li>可能导致安全问题，需要仔细控制权限</li>
<li>常用于代理模式和合约升级</li>
</ol>
</blockquote>
<h3 id="heading-30">内联汇编</h3>
<p>Solidity 允许我们使用内联汇编来直接操作 EVM。这就像是给了我们一把&quot;万能钥匙&quot;，可以做一些普通 Solidity 做不到的事情：</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">AssemblyExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 使用汇编优化存储操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">writeStorage</span>(<span style="color:#66d9ef">uint</span> slot, <span style="color:#66d9ef">uint</span> value) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">sstore</span>(slot, value)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 使用汇编读取合约代码大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCodeSize</span>(<span style="color:#66d9ef">address</span> addr) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span> size) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> {
</span></span><span style="display:flex;"><span>            size <span style="color:#f92672">:=</span> <span style="color:#a6e22e">extcodesize</span>(addr)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 使用汇编进行高效的内存操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">efficientArraySum</span>(<span style="color:#66d9ef">uint</span>[] <span style="color:#66d9ef">memory</span> arr) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">pure</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span> sum) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">let</span> len <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mload</span>(arr)
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">let</span> data <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(arr, <span style="color:#ae81ff">0x20</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">for</span> { <span style="color:#f92672">let</span> i <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span> } <span style="color:#a6e22e">lt</span>(i, len) { i <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(i, <span style="color:#ae81ff">1</span>) }
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                sum <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(sum, <span style="color:#a6e22e">mload</span>(<span style="color:#a6e22e">add</span>(data, <span style="color:#a6e22e">mul</span>(i, <span style="color:#ae81ff">0x20</span>))))
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><h3 id="heading-31">创建合约</h3>
<p>Solidity 提供了两种在运行时创建新合约的方法：create 和 create2。</p>
<pre style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Factory</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 使用 create 部署合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deployWithCreate</span>(<span style="color:#66d9ef">uint</span> _salt) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">address</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bytes</span> <span style="color:#66d9ef">memory</span> bytecode <span style="color:#f92672">=</span> type(<span style="color:#a6e22e">MyContract</span>).creationCode;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> addr;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> {
</span></span><span style="display:flex;"><span>            addr <span style="color:#f92672">:=</span> <span style="color:#a6e22e">create</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">add</span>(bytecode, <span style="color:#ae81ff">0x20</span>), <span style="color:#a6e22e">mload</span>(bytecode))
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">return</span> addr<span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 使用 create2 部署合约
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deployWithCreate2</span>(<span style="color:#66d9ef">uint</span> _salt) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">address</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bytes</span> <span style="color:#66d9ef">memory</span> bytecode <span style="color:#f92672">=</span> type(<span style="color:#a6e22e">MyContract</span>).creationCode;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> addr;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assembly</span> {
</span></span><span style="display:flex;"><span>            addr <span style="color:#f92672">:=</span> create2(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">add</span>(bytecode, <span style="color:#ae81ff">0x20</span>), <span style="color:#a6e22e">mload</span>(bytecode), _salt)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">return</span> addr<span style="color:#960050;background-color:#1e0010">;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><hr />
<h2 id="heading-32">结语</h2>
<p>到这里，我们已经完整地探索了 Solidity 的主要特性。从基础的数据类型到高级的委托调用，从简单的函数定义到复杂的合约交互，相信你已经对 Solidity 编程有了全面的认识。</p>
<p>记住，区块链世界日新月异，Solidity 也在不断发展。这篇指南为你打开了智能合约开发的大门，但真正的学习之旅才刚刚开始。</p>

                    </div>

                    
                    <div class="flex items-center justify-between gap-4 p-4 lg:p-6 border-t border-stars-accent/10
                                bg-gradient-to-br from-transparent to-stars-accent/5">
                        
                        <button onclick="share()" 
                                class="inline-flex items-center gap-2 px-4 py-2 rounded-xl
                                       bg-stars-primary/30 backdrop-blur-sm
                                       border border-stars-accent/20 
                                       text-stars-accent hover:bg-stars-accent/10
                                       hover:scale-[1.02] active:scale-[0.98]
                                       transition-all duration-300">
                            <i class="fas fa-share-alt"></i>
                            <span>分享文章</span>
                        </button>

                        
                        
                        <button onclick="copyHash('0x47c54e59d3e44e9b2ede352ca79e99a7e05a5f7ff9d1208e84a2162583bee4bb1.0.0')"
                                class="inline-flex items-center gap-2 px-4 py-2 rounded-xl
                                       bg-stars-primary/30 backdrop-blur-sm
                                       border border-stars-accent/20 
                                       text-stars-accent hover:bg-stars-accent/10
                                       hover:scale-[1.02] active:scale-[0.98]
                                       transition-all duration-300
                                       group">
                            <i class="fas fa-fingerprint text-stars-accent/70 group-hover:text-stars-accent"></i>
                            <code class="font-mono text-sm truncate max-w-[150px]">0x47c54e59d3e44e9b2ede352ca79e99a7e05a5f7ff9d1208e84a2162583bee4bb1.0.0</code>
                        </button>
                        
                    </div>
                </div>

                
                

<div class="newsletter-container bg-stars-secondary/80 backdrop-blur-sm rounded-2xl 
            border border-stars-accent/10 p-6 my-8">
    <h3 class="text-xl font-bold text-stars-accent mb-3">订阅更新</h3>
    <p class="text-stars-muted mb-4">订阅获取最新文章更新</p>
    
    
    <form
        action="https://buttondown.email/api/emails/embed-subscribe/lige"
        method="post"
        target="popupwindow"
        class="flex gap-2"
        onsubmit="window.open('https://buttondown.email/lige', 'popupwindow')"
    >
        <input
            type="email"
            name="email"
            placeholder="your@email.com"
            class="flex-1 px-4 py-2 rounded-xl bg-stars-primary/30 
                   border border-stars-accent/20 text-stars-accent
                   focus:border-stars-accent focus:outline-none"
            required
        >
        <button 
            type="submit"
            class="px-6 py-2 rounded-xl bg-stars-accent/10 text-stars-accent
                   hover:bg-stars-accent/20 transition-all duration-300"
        >
            订阅
        </button>
    </form>
</div>


                
                
                
                <div id="verification" class="bg-stars-secondary/80 backdrop-blur-sm rounded-2xl border border-stars-accent/10 overflow-hidden">
                    
                    <div class="p-6 lg:p-8 border-b border-stars-accent/10 bg-gradient-to-br from-stars-accent/5 to-transparent">
                        <div class="flex items-center gap-3 text-stars-accent mb-2">
                            <h3 class="text-xl font-bold">链上验证</h3>
                        </div>
                        <p class="text-stars-muted text-sm leading-relaxed">
                            此文章已被永久存储在区块链上，并由其创作者进行了签名验证。您可以查看相关证明，也可以将其铸造为 NFT 收藏。
                        </p>
                    </div>

                    
                    <div class="p-6 lg:p-8">
                        
                        <div class="grid gap-4 sm:grid-cols-2 mb-8">
                            
                            
                            <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                <div class="text-stars-muted text-sm mb-2">创作者地址</div>
                                <code class="text-stars-accent break-all text-sm">0x16572b97410200e79AB6c9423F8d9778F0Fb9C54</code>
                            </div>
                            

                            
                            <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                <div class="text-stars-muted text-sm mb-2">Arweave 交易</div>
                                <code class="text-stars-accent break-all text-sm">uAUrXIBsIUwSr2nYLHW48JUtNswmA6CENEY2_-pBHZM</code>
                            </div>
                            

                            
                            <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                <div class="text-stars-muted text-sm mb-2">NFT 合约</div>
                                <code class="text-stars-accent break-all text-sm">0x903e48Ca585dBF4dFeb74f2864501feB6f0dF369</code>
                            </div>
                            

                            
                            <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                <div class="text-stars-muted text-sm mb-2">内容哈希</div>
                                <code class="text-stars-accent break-all text-sm">0x47c54e59d3e44e9b2ede352ca79e99a7e05a5f7ff9d1208e84a2162583bee4bb1.0.0</code>
                            </div>
                            
                        </div>

                        
                        <div class="mb-8">
                            <h4 class="text-lg font-bold text-stars-accent mb-4">NFT 详情</h4>
                            <div class="grid gap-4 sm:grid-cols-3">
                                
                                <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                    <div class="text-stars-muted text-sm mb-1">铸造价格</div>
                                    <div class="text-stars-accent font-mono">0 TLOS</div>
                                </div>
                                

                                
                                <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                    <div class="text-stars-muted text-sm mb-1">最大供应量</div>
                                    <div class="text-stars-accent font-mono">9999</div>
                                </div>
                                

                                

                                
                                <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                    <div class="text-stars-muted text-sm mb-1">Chain ID</div>
                                    <div class="text-stars-accent font-mono">41</div>
                                </div>
                                

                                
                                <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                    <div class="text-stars-muted text-sm mb-1">合约版本</div>
                                    <div class="text-stars-accent font-mono">v1.0.0</div>
                                </div>
                                

                                
                                <div class="p-4 rounded-xl bg-stars-primary/10 border border-stars-accent/10">
                                    <div class="text-stars-muted text-sm mb-1">每地址限制</div>
                                    <div class="text-stars-accent font-mono">1 枚</div>
                                </div>
                                
                            </div>
                        </div>

                        
                        <div class="flex justify-center">
                            <button id="mintButton2" onclick="mintNFT()" 
                                    class="px-6 py-3 rounded-xl bg-stars-accent/10 text-stars-accent 
                                           hover:bg-stars-accent/20 transition-all duration-300">
                                <span class="flex items-center gap-2">
                                    <i class="fas fa-cube text-stars-gold"></i>
                                    <span id="mintButtonText2" class="text-stars-gold">铸造 NFT</span>
                                </span>
                                <span id="mintSpinner2" class="hidden">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
                

                
                
                <div class="mb-8">
                    <div class="bg-stars-secondary/80 backdrop-blur-sm rounded-2xl border border-stars-accent/10 p-4 sm:p-6" id="series-nav">
                        
                        <div class="sm:hidden">
                            <h3 class="text-lg font-bold mb-3">探索Web3世界</h3>
                            <div class="text-stars-muted text-sm mb-4">
                                您正在阅读 <span class="text-stars-accent">探索Web3世界</span> 系列的第 6 篇文章
                            </div>
                            <a href="/series/%e6%8e%a2%e7%b4%a2Web3%e4%b8%96%e7%95%8c" 
                               class="block w-full text-center px-4 py-2.5 rounded-xl bg-stars-primary/20 border border-stars-accent/20 
                                      hover:border-stars-accent/30 hover:bg-stars-accent/5 
                                      transition-all duration-300">
                                <span class="flex items-center justify-center gap-2">
                                    <span class="text-sm">查看系列全部文章</span>
                                    <i class="fas fa-arrow-right text-stars-accent/80"></i>
                                </span>
                            </a>
                        </div>

                        
                        <div class="hidden sm:block">
                            <div class="flex items-center justify-between gap-4 mb-4">
                                <div class="flex items-center gap-3">
                                    <h3 class="text-lg font-bold">探索Web3世界</h3>
                                </div>
                                <a href="/series/%e6%8e%a2%e7%b4%a2Web3%e4%b8%96%e7%95%8c" 
                                   class="px-4 py-2 rounded-xl bg-stars-primary/20 border border-stars-accent/20 
                                          hover:border-stars-accent/30 hover:bg-stars-accent/5 
                                          transition-all duration-300">
                                    <span class="flex items-center gap-2">
                                        <span class="text-sm">查看系列全部文章</span>
                                        <i class="fas fa-arrow-right text-stars-accent/80"></i>
                                    </span>
                                </a>
                            </div>
                            <div class="text-stars-muted">
                                您正在阅读 <span class="text-stars-accent">探索Web3世界</span> 系列的第 6 篇文章
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        
        
        <div class="hidden lg:block lg:col-span-3">
            <div class="sticky top-24">
                
<div class="table-of-contents-wrapper">
    <div class="text-lg font-bold text-stars-accent mb-4">目录</div>
    <nav class="table-of-contents">
        <ul>
            
            <li>
                <a href="#heading" 
                   title="基础知识"
                   class="toc-link toc-link-root"
                   data-level="2">
                    基础知识
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#-solidity" 
           title="为什么选择 Solidity？"
           class="toc-link toc-link-child"
           data-level="3">
            为什么选择 Solidity？
        </a>
        
    </li>
    
    <li>
        <a href="#remix-ide" 
           title="开发环境：Remix IDE"
           class="toc-link toc-link-child"
           data-level="3">
            开发环境：Remix IDE
        </a>
        
    </li>
    
    <li>
        <a href="#heading-1" 
           title="数据存储位置"
           class="toc-link toc-link-child"
           data-level="3">
            数据存储位置
        </a>
        
            <ul>
                
    
    <li>
        <a href="#storage" 
           title="Storage（永久存储）"
           class="toc-link toc-link-child"
           data-level="4">
            Storage（永久存储）
        </a>
        
    </li>
    
    <li>
        <a href="#memory" 
           title="Memory（临时存储）"
           class="toc-link toc-link-child"
           data-level="4">
            Memory（临时存储）
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#import-" 
           title="import 导入"
           class="toc-link toc-link-child"
           data-level="3">
            import 导入
        </a>
        
    </li>
    
    <li>
        <a href="#heading-2" 
           title="版权声明"
           class="toc-link toc-link-child"
           data-level="3">
            版权声明
        </a>
        
    </li>
    
    <li>
        <a href="#heading-3" 
           title="版本声明"
           class="toc-link toc-link-child"
           data-level="3">
            版本声明
        </a>
        
    </li>
    
    <li>
        <a href="#heading-4" 
           title="定义合约"
           class="toc-link toc-link-child"
           data-level="3">
            定义合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-5" 
                   title="数据类型和变量"
                   class="toc-link toc-link-root"
                   data-level="2">
                    数据类型和变量
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-6" 
           title="基本数据类型"
           class="toc-link toc-link-child"
           data-level="3">
            基本数据类型
        </a>
        
            <ul>
                
    
    <li>
        <a href="#bool" 
           title="布尔型（bool）"
           class="toc-link toc-link-child"
           data-level="4">
            布尔型（bool）
        </a>
        
    </li>
    
    <li>
        <a href="#integer" 
           title="整数类型（Integer）"
           class="toc-link toc-link-child"
           data-level="4">
            整数类型（Integer）
        </a>
        
    </li>
    
    <li>
        <a href="#-uint256--gas" 
           title="为什么 uint256 有时候更省 gas？"
           class="toc-link toc-link-child"
           data-level="4">
            为什么 uint256 有时候更省 gas？
        </a>
        
    </li>
    
    <li>
        <a href="#address" 
           title="地址类型（Address）"
           class="toc-link toc-link-child"
           data-level="4">
            地址类型（Address）
        </a>
        
    </li>
    
    <li>
        <a href="#bytes" 
           title="字节类型（Bytes）"
           class="toc-link toc-link-child"
           data-level="4">
            字节类型（Bytes）
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-7" 
           title="复杂数据类型"
           class="toc-link toc-link-child"
           data-level="3">
            复杂数据类型
        </a>
        
            <ul>
                
    
    <li>
        <a href="#heading-8" 
           title="数组"
           class="toc-link toc-link-child"
           data-level="4">
            数组
        </a>
        
    </li>
    
    <li>
        <a href="#heading-9" 
           title="字符串"
           class="toc-link toc-link-child"
           data-level="4">
            字符串
        </a>
        
    </li>
    
    <li>
        <a href="#heading-10" 
           title="映射"
           class="toc-link toc-link-child"
           data-level="4">
            映射
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-11" 
           title="常量"
           class="toc-link toc-link-child"
           data-level="3">
            常量
        </a>
        
            <ul>
                
    
    <li>
        <a href="#constant" 
           title="constant"
           class="toc-link toc-link-child"
           data-level="4">
            constant
        </a>
        
    </li>
    
    <li>
        <a href="#immutable" 
           title="immutable"
           class="toc-link toc-link-child"
           data-level="4">
            immutable
        </a>
        
    </li>
    
    <li>
        <a href="#constant-vs-immutable-" 
           title="constant vs immutable 如何选择？"
           class="toc-link toc-link-child"
           data-level="4">
            constant vs immutable 如何选择？
        </a>
        
    </li>
    

            </ul>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-12" 
                   title="函数"
                   class="toc-link toc-link-root"
                   data-level="2">
                    函数
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-13" 
           title="函数定义"
           class="toc-link toc-link-child"
           data-level="3">
            函数定义
        </a>
        
    </li>
    
    <li>
        <a href="#heading-14" 
           title="函数可见性"
           class="toc-link toc-link-child"
           data-level="3">
            函数可见性
        </a>
        
    </li>
    
    <li>
        <a href="#heading-15" 
           title="函数修饰符"
           class="toc-link toc-link-child"
           data-level="3">
            函数修饰符
        </a>
        
    </li>
    
    <li>
        <a href="#heading-16" 
           title="特殊函数"
           class="toc-link toc-link-child"
           data-level="3">
            特殊函数
        </a>
        
    </li>
    
    <li>
        <a href="#heading-17" 
           title="函数重载"
           class="toc-link toc-link-child"
           data-level="3">
            函数重载
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-18" 
                   title="程序控制"
                   class="toc-link toc-link-root"
                   data-level="2">
                    程序控制
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-19" 
           title="错误处理最佳实践"
           class="toc-link toc-link-child"
           data-level="3">
            错误处理最佳实践
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-20" 
                   title="面向对象特性"
                   class="toc-link toc-link-root"
                   data-level="2">
                    面向对象特性
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-21" 
           title="继承"
           class="toc-link toc-link-child"
           data-level="3">
            继承
        </a>
        
    </li>
    
    <li>
        <a href="#heading-22" 
           title="接口"
           class="toc-link toc-link-child"
           data-level="3">
            接口
        </a>
        
    </li>
    
    <li>
        <a href="#heading-23" 
           title="抽象合约"
           class="toc-link toc-link-child"
           data-level="3">
            抽象合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-24" 
                   title="高级特性"
                   class="toc-link toc-link-root"
                   data-level="2">
                    高级特性
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#modifier" 
           title="修饰符（modifier）"
           class="toc-link toc-link-child"
           data-level="3">
            修饰符（modifier）
        </a>
        
    </li>
    
    <li>
        <a href="#event" 
           title="事件（event）"
           class="toc-link toc-link-child"
           data-level="3">
            事件（event）
        </a>
        
            <ul>
                
    
    <li>
        <a href="#heading-25" 
           title="事件的存储位置"
           class="toc-link toc-link-child"
           data-level="4">
            事件的存储位置
        </a>
        
    </li>
    
    <li>
        <a href="#heading-26" 
           title="事件的接收方式"
           class="toc-link toc-link-child"
           data-level="4">
            事件的接收方式
        </a>
        
    </li>
    
    <li>
        <a href="#heading-27" 
           title="事件的特点"
           class="toc-link toc-link-child"
           data-level="4">
            事件的特点
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-28" 
           title="事件重放"
           class="toc-link toc-link-child"
           data-level="3">
            事件重放
        </a>
        
    </li>
    
    <li>
        <a href="#library" 
           title="库（Library）"
           class="toc-link toc-link-child"
           data-level="3">
            库（Library）
        </a>
        
    </li>
    
    <li>
        <a href="#unchecked" 
           title="屏蔽溢出检查（unchecked）"
           class="toc-link toc-link-child"
           data-level="3">
            屏蔽溢出检查（unchecked）
        </a>
        
    </li>
    
    <li>
        <a href="#heading-29" 
           title="委托调用"
           class="toc-link toc-link-child"
           data-level="3">
            委托调用
        </a>
        
    </li>
    
    <li>
        <a href="#heading-30" 
           title="内联汇编"
           class="toc-link toc-link-child"
           data-level="3">
            内联汇编
        </a>
        
    </li>
    
    <li>
        <a href="#heading-31" 
           title="创建合约"
           class="toc-link toc-link-child"
           data-level="3">
            创建合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-32" 
                   title="结语"
                   class="toc-link toc-link-root"
                   data-level="2">
                    结语
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>

            </div>
        </div>
        
    </div>

    
    <button id="backToTop" 
            onclick="scrollToTop()"
            class="fixed bottom-8 right-8 p-3 rounded-xl
                   bg-stars-secondary/80 backdrop-blur-sm
                   border border-stars-accent/20 text-stars-accent
                   hover:bg-stars-accent/10 hover:scale-110
                   active:scale-95
                   transition-all duration-300
                   opacity-0 invisible
                   lg:bottom-12 lg:right-12
                   shadow-lg shadow-stars-accent/5">
        <i class="fas fa-arrow-up"></i>
    </button>

    
    <div id="shareModal" class="fixed inset-0 z-50 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                    w-full max-w-md p-6 
                    bg-stars-secondary/90 backdrop-blur-sm 
                    rounded-xl border border-stars-accent/20">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-bold text-stars-accent">分享文章</h3>
                <button onclick="closeModal('shareModal')" 
                        class="w-8 h-8 flex items-center justify-center rounded-xl
                               hover:bg-stars-primary/30 text-stars-muted hover:text-stars-accent 
                               transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <button onclick="shareToTwitter()" 
                        class="flex flex-col items-center gap-2 p-4 rounded-xl
                               bg-stars-primary/30 hover:bg-stars-accent/20 
                               text-stars-accent transition-all duration-300
                               group">
                    <i class="fab fa-twitter text-2xl group-hover:scale-110 transition-transform"></i>
                    <span class="text-sm">Twitter</span>
                </button>
                <button onclick="shareToTelegram()" 
                        class="flex flex-col items-center gap-2 p-4 rounded-xl
                               bg-stars-primary/30 hover:bg-stars-accent/20 
                               text-stars-accent transition-all duration-300
                               group">
                    <i class="fab fa-telegram text-2xl group-hover:scale-110 transition-transform"></i>
                    <span class="text-sm">Telegram</span>
                </button>
                <button onclick="shareToReddit()" 
                        class="flex flex-col items-center gap-2 p-4 rounded-xl
                               bg-stars-primary/30 hover:bg-stars-accent/20 
                               text-stars-accent transition-all duration-300
                               group">
                    <i class="fab fa-reddit text-2xl group-hover:scale-110 transition-transform"></i>
                    <span class="text-sm">Reddit</span>
                </button>
            </div>
            <button onclick="copyLink()" 
                    class="w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl
                           bg-stars-primary/30 hover:bg-stars-accent/20 
                           text-stars-accent transition-all duration-300
                           group">
                <i class="fas fa-link text-lg group-hover:scale-110 transition-transform"></i>
                <span>复制链接</span>
            </button>
        </div>
    </div>

    
    <div id="toast" 
         class="fixed bottom-8 left-1/2 -translate-x-1/2 
                py-3 px-6 rounded-xl
                backdrop-blur-sm
                border border-stars-accent/20
                shadow-lg
                transform transition-all duration-300 scale-0 opacity-0
                flex items-center gap-3
                bg-stars-accent/10 text-stars-accent">
        <span id="toastIcon">
            <i class="fas fa-check-circle text-lg"></i>
        </span>
        <span id="toastMessage"></span>
    </div>

    
    <script>
    function share() {
        const modal = document.getElementById('shareModal');
        modal.classList.remove('opacity-0', 'pointer-events-none');
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('opacity-0', 'pointer-events-none');
    }

    function shareToTwitter() {
        const text = encodeURIComponent(`${document.title}`);
        const url = encodeURIComponent(window.location.href);
        window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
    }

    function shareToTelegram() {
        const text = encodeURIComponent(document.title);
        const url = encodeURIComponent(window.location.href);
        window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
    }

    function shareToReddit() {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);
        window.open(`https://reddit.com/submit?url=${url}&title=${title}`, '_blank');
    }

    function copyLink() {
        const tempInput = document.createElement('input');
        tempInput.value = window.location.href;
        document.body.appendChild(tempInput);
        tempInput.select();
        
        try {
            document.execCommand('copy');
            window.showToast('链接已复制到剪贴板 ✨');
            closeModal('shareModal');
        } catch (err) {
            window.showToast('复制失败，请手动复制链接');
        } finally {
            document.body.removeChild(tempInput);
        }
    }

    
    document.getElementById('shareModal').addEventListener('click', function(e) {
        if (e.target === this) {
            e.target.classList.add('opacity-0', 'pointer-events-none');
        }
    });
    </script>

    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tocLinks = document.querySelectorAll('.toc-link');
        const headings = document.querySelectorAll('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6');
        let isScrolling = false;  
        
        
        tocLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                isScrolling = true;  
                
                const href = link.getAttribute('href');
                const targetId = href.substring(1);
                const target = document.getElementById(targetId);
                
                if (target) {
                    
                    tocLinks.forEach(l => l.classList.remove('active'));
                    
                    link.classList.add('active');
                    
                    const offset = target.offsetTop - 100;
                    window.scrollTo({
                        top: offset,
                        behavior: 'smooth'
                    });
                    
                    
                    history.pushState(null, '', href);
                    
                    
                    setTimeout(() => {
                        isScrolling = false;
                    }, 100);
                }
            });
        });

        
        const observerOptions = {
            root: null,
            rootMargin: '-100px 0px -80% 0px',
            threshold: [0, 1]  
        };

        const headingObserver = new IntersectionObserver((entries) => {
            if (isScrolling) return;  

            
            const visibleEntries = entries.filter(entry => entry.isIntersecting);
            if (visibleEntries.length === 0) return;

            
            const topEntry = visibleEntries.reduce((prev, curr) => {
                const prevY = Math.abs(prev.boundingClientRect.y);
                const currY = Math.abs(curr.boundingClientRect.y);
                return prevY < currY ? prev : curr;
            });

            const id = topEntry.target.id;
            
            
            tocLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href === `#${id}`) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }, observerOptions);

        
        headings.forEach(heading => {
            if (heading.id) {
                headingObserver.observe(heading);
            }
        });

        
        if (window.location.hash) {
            const targetId = window.location.hash.slice(1);
            const target = document.getElementById(targetId);
            if (target) {
                setTimeout(() => {
                    const offset = target.offsetTop - 100;
                    window.scrollTo({
                        top: offset,
                        behavior: 'smooth'
                    });
                    
                    console.log(targetId);
                    
                    const activeLink = document.querySelector(`.toc-link[href="#${targetId}"]`);
                    if (activeLink) {
                        tocLinks.forEach(l => l.classList.remove('active'));
                        activeLink.classList.add('active');
                    }
                }, 100);
            }
        }
    });
    </script>

    
    <script>
    
    const backToTopButton = document.getElementById('backToTop');
    
    window.addEventListener('scroll', () => {
        if (window.scrollY > 500) {
            backToTopButton.classList.remove('opacity-0', 'invisible');
            backToTopButton.classList.add('opacity-100', 'visible');
        } else {
            backToTopButton.classList.add('opacity-0', 'invisible');
            backToTopButton.classList.remove('opacity-100', 'visible');
        }
    });

    
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    if ('vibrate' in navigator) {
        const buttons = document.querySelectorAll('button, a');
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                navigator.vibrate(10);
            });
        });
    }
    </script>

    
    <div class="lg:hidden fixed bottom-8 left-8 z-50" id="tocButton">
        <button onclick="toggleToc()"
                class="p-3 rounded-xl bg-stars-secondary/80 backdrop-blur-sm
                       border border-stars-accent/20 text-stars-accent
                       hover:bg-stars-accent/10 transition-all duration-300
                       shadow-lg shadow-stars-accent/5">
            <i class="fas fa-list-ul"></i>
        </button>
    </div>

    
    <div id="tocDrawer" 
         class="lg:hidden fixed inset-0 z-40 transform transition-transform duration-300 translate-x-full">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="toggleToc()"></div>
        <div class="absolute right-0 top-0 bottom-0 w-3/4 max-w-sm bg-stars-secondary/95 backdrop-blur-sm
                    border-l border-stars-accent/20 overflow-y-auto
                    pt-20">
            <div>
                
<div class="table-of-contents-wrapper">
    <div class="text-lg font-bold text-stars-accent mb-4">目录</div>
    <nav class="table-of-contents">
        <ul>
            
            <li>
                <a href="#heading" 
                   title="基础知识"
                   class="toc-link toc-link-root"
                   data-level="2">
                    基础知识
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#-solidity" 
           title="为什么选择 Solidity？"
           class="toc-link toc-link-child"
           data-level="3">
            为什么选择 Solidity？
        </a>
        
    </li>
    
    <li>
        <a href="#remix-ide" 
           title="开发环境：Remix IDE"
           class="toc-link toc-link-child"
           data-level="3">
            开发环境：Remix IDE
        </a>
        
    </li>
    
    <li>
        <a href="#heading-1" 
           title="数据存储位置"
           class="toc-link toc-link-child"
           data-level="3">
            数据存储位置
        </a>
        
            <ul>
                
    
    <li>
        <a href="#storage" 
           title="Storage（永久存储）"
           class="toc-link toc-link-child"
           data-level="4">
            Storage（永久存储）
        </a>
        
    </li>
    
    <li>
        <a href="#memory" 
           title="Memory（临时存储）"
           class="toc-link toc-link-child"
           data-level="4">
            Memory（临时存储）
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#import-" 
           title="import 导入"
           class="toc-link toc-link-child"
           data-level="3">
            import 导入
        </a>
        
    </li>
    
    <li>
        <a href="#heading-2" 
           title="版权声明"
           class="toc-link toc-link-child"
           data-level="3">
            版权声明
        </a>
        
    </li>
    
    <li>
        <a href="#heading-3" 
           title="版本声明"
           class="toc-link toc-link-child"
           data-level="3">
            版本声明
        </a>
        
    </li>
    
    <li>
        <a href="#heading-4" 
           title="定义合约"
           class="toc-link toc-link-child"
           data-level="3">
            定义合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-5" 
                   title="数据类型和变量"
                   class="toc-link toc-link-root"
                   data-level="2">
                    数据类型和变量
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-6" 
           title="基本数据类型"
           class="toc-link toc-link-child"
           data-level="3">
            基本数据类型
        </a>
        
            <ul>
                
    
    <li>
        <a href="#bool" 
           title="布尔型（bool）"
           class="toc-link toc-link-child"
           data-level="4">
            布尔型（bool）
        </a>
        
    </li>
    
    <li>
        <a href="#integer" 
           title="整数类型（Integer）"
           class="toc-link toc-link-child"
           data-level="4">
            整数类型（Integer）
        </a>
        
    </li>
    
    <li>
        <a href="#-uint256--gas" 
           title="为什么 uint256 有时候更省 gas？"
           class="toc-link toc-link-child"
           data-level="4">
            为什么 uint256 有时候更省 gas？
        </a>
        
    </li>
    
    <li>
        <a href="#address" 
           title="地址类型（Address）"
           class="toc-link toc-link-child"
           data-level="4">
            地址类型（Address）
        </a>
        
    </li>
    
    <li>
        <a href="#bytes" 
           title="字节类型（Bytes）"
           class="toc-link toc-link-child"
           data-level="4">
            字节类型（Bytes）
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-7" 
           title="复杂数据类型"
           class="toc-link toc-link-child"
           data-level="3">
            复杂数据类型
        </a>
        
            <ul>
                
    
    <li>
        <a href="#heading-8" 
           title="数组"
           class="toc-link toc-link-child"
           data-level="4">
            数组
        </a>
        
    </li>
    
    <li>
        <a href="#heading-9" 
           title="字符串"
           class="toc-link toc-link-child"
           data-level="4">
            字符串
        </a>
        
    </li>
    
    <li>
        <a href="#heading-10" 
           title="映射"
           class="toc-link toc-link-child"
           data-level="4">
            映射
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-11" 
           title="常量"
           class="toc-link toc-link-child"
           data-level="3">
            常量
        </a>
        
            <ul>
                
    
    <li>
        <a href="#constant" 
           title="constant"
           class="toc-link toc-link-child"
           data-level="4">
            constant
        </a>
        
    </li>
    
    <li>
        <a href="#immutable" 
           title="immutable"
           class="toc-link toc-link-child"
           data-level="4">
            immutable
        </a>
        
    </li>
    
    <li>
        <a href="#constant-vs-immutable-" 
           title="constant vs immutable 如何选择？"
           class="toc-link toc-link-child"
           data-level="4">
            constant vs immutable 如何选择？
        </a>
        
    </li>
    

            </ul>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-12" 
                   title="函数"
                   class="toc-link toc-link-root"
                   data-level="2">
                    函数
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-13" 
           title="函数定义"
           class="toc-link toc-link-child"
           data-level="3">
            函数定义
        </a>
        
    </li>
    
    <li>
        <a href="#heading-14" 
           title="函数可见性"
           class="toc-link toc-link-child"
           data-level="3">
            函数可见性
        </a>
        
    </li>
    
    <li>
        <a href="#heading-15" 
           title="函数修饰符"
           class="toc-link toc-link-child"
           data-level="3">
            函数修饰符
        </a>
        
    </li>
    
    <li>
        <a href="#heading-16" 
           title="特殊函数"
           class="toc-link toc-link-child"
           data-level="3">
            特殊函数
        </a>
        
    </li>
    
    <li>
        <a href="#heading-17" 
           title="函数重载"
           class="toc-link toc-link-child"
           data-level="3">
            函数重载
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-18" 
                   title="程序控制"
                   class="toc-link toc-link-root"
                   data-level="2">
                    程序控制
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-19" 
           title="错误处理最佳实践"
           class="toc-link toc-link-child"
           data-level="3">
            错误处理最佳实践
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-20" 
                   title="面向对象特性"
                   class="toc-link toc-link-root"
                   data-level="2">
                    面向对象特性
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#heading-21" 
           title="继承"
           class="toc-link toc-link-child"
           data-level="3">
            继承
        </a>
        
    </li>
    
    <li>
        <a href="#heading-22" 
           title="接口"
           class="toc-link toc-link-child"
           data-level="3">
            接口
        </a>
        
    </li>
    
    <li>
        <a href="#heading-23" 
           title="抽象合约"
           class="toc-link toc-link-child"
           data-level="3">
            抽象合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-24" 
                   title="高级特性"
                   class="toc-link toc-link-root"
                   data-level="2">
                    高级特性
                </a>
                
                    <ul>
                        
    
    <li>
        <a href="#modifier" 
           title="修饰符（modifier）"
           class="toc-link toc-link-child"
           data-level="3">
            修饰符（modifier）
        </a>
        
    </li>
    
    <li>
        <a href="#event" 
           title="事件（event）"
           class="toc-link toc-link-child"
           data-level="3">
            事件（event）
        </a>
        
            <ul>
                
    
    <li>
        <a href="#heading-25" 
           title="事件的存储位置"
           class="toc-link toc-link-child"
           data-level="4">
            事件的存储位置
        </a>
        
    </li>
    
    <li>
        <a href="#heading-26" 
           title="事件的接收方式"
           class="toc-link toc-link-child"
           data-level="4">
            事件的接收方式
        </a>
        
    </li>
    
    <li>
        <a href="#heading-27" 
           title="事件的特点"
           class="toc-link toc-link-child"
           data-level="4">
            事件的特点
        </a>
        
    </li>
    

            </ul>
        
    </li>
    
    <li>
        <a href="#heading-28" 
           title="事件重放"
           class="toc-link toc-link-child"
           data-level="3">
            事件重放
        </a>
        
    </li>
    
    <li>
        <a href="#library" 
           title="库（Library）"
           class="toc-link toc-link-child"
           data-level="3">
            库（Library）
        </a>
        
    </li>
    
    <li>
        <a href="#unchecked" 
           title="屏蔽溢出检查（unchecked）"
           class="toc-link toc-link-child"
           data-level="3">
            屏蔽溢出检查（unchecked）
        </a>
        
    </li>
    
    <li>
        <a href="#heading-29" 
           title="委托调用"
           class="toc-link toc-link-child"
           data-level="3">
            委托调用
        </a>
        
    </li>
    
    <li>
        <a href="#heading-30" 
           title="内联汇编"
           class="toc-link toc-link-child"
           data-level="3">
            内联汇编
        </a>
        
    </li>
    
    <li>
        <a href="#heading-31" 
           title="创建合约"
           class="toc-link toc-link-child"
           data-level="3">
            创建合约
        </a>
        
    </li>
    

                    </ul>
                
            </li>
            
            <li>
                <a href="#heading-32" 
                   title="结语"
                   class="toc-link toc-link-root"
                   data-level="2">
                    结语
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>

            </div>
        </div>
    </div>

    
    <script>
    function toggleToc() {
        const drawer = document.getElementById('tocDrawer');
        if (drawer.classList.contains('translate-x-full')) {
            drawer.classList.remove('translate-x-full');
        } else {
            drawer.classList.add('translate-x-full');
        }
    }
    </script>
    
    
    <div id="articleData" 
         data-verification="{&#34;ArweaveId&#34;:&#34;uAUrXIBsIUwSr2nYLHW48JUtNswmA6CENEY2_-pBHZM&#34;,&#34;NftContract&#34;:&#34;0x903e48Ca585dBF4dFeb74f2864501feB6f0dF369&#34;,&#34;Author&#34;:&#34;0x16572b97410200e79AB6c9423F8d9778F0Fb9C54&#34;,&#34;ContentHash&#34;:&#34;0x47c54e59d3e44e9b2ede352ca79e99a7e05a5f7ff9d1208e84a2162583bee4bb1.0.0&#34;,&#34;NFT&#34;:{&#34;Price&#34;:&#34;0&#34;,&#34;MaxSupply&#34;:9999,&#34;RoyaltyFee&#34;:0,&#34;OnePerAddress&#34;:true,&#34;Version&#34;:&#34;1.0.0&#34;,&#34;ChainId&#34;:41,&#34;TokenSymbol&#34;:&#34;TLOS&#34;}}"
         data-title="探索web3世界：Solidity 完全入门指南"
         style="display: none;">
    </div>

    
    <script>
    function scrollToVerification() {
        const verificationSection = document.getElementById('verification');
        if (verificationSection) {
            const offset = verificationSection.offsetTop; 
            window.scrollTo({
                top: offset,
                behavior: 'smooth'
            });
        }
    }
    </script>

    
    <script>
    function copyHash(hash) {
        
        navigator.clipboard.writeText(hash).then(() => {
            
            window.showToast('文章内容哈希已复制 ✨');
        }).catch(() => {
            window.showToast('复制失败，请手动复制');
        });
    }
    </script>
</article>

    </main>

    
    
<footer class="py-8 mt-12 bg-stars-secondary/30 backdrop-blur-sm border-t border-stars-accent/10">
    <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
            
            <div class="text-stars-muted text-sm">
                © 2025 鲤哥的博客
            </div>

            
            <div class="flex items-center gap-2">
                
                <a href="/feed.xml" 
                   class="flex items-center gap-2 px-3 py-1.5 rounded-lg
                          bg-stars-primary/20 text-stars-muted hover:text-stars-accent
                          border border-stars-accent/10 hover:border-stars-accent/30
                          transition-all duration-300"
                   title="RSS 订阅">
                    <i class="fas fa-rss"></i>
                    <span class="text-sm">RSS</span>
                </a>

                
                
                <a href="https://buttondown.email/lige" 
                   target="_blank"
                   class="flex items-center gap-2 px-3 py-1.5 rounded-lg
                          bg-stars-primary/20 text-stars-muted hover:text-stars-accent
                          border border-stars-accent/10 hover:border-stars-accent/30
                          transition-all duration-300"
                   title="邮件订阅">
                    <i class="fas fa-envelope"></i>
                    <span class="text-sm">邮件订阅</span>
                </a>
                
            </div>

            
            <div class="text-stars-muted text-sm">
                Powered by <a href="https://github.com/jiangjiax/stars" 
                            class="text-stars-accent hover:text-stars-gold">Stars</a>
            </div>
        </div>
    </div>
</footer>


    
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <script src="/static/dist/main.51ab9f649b4caa7df89d.bundle.js"></script>
    
    <script src="/static/dist/nft.ffb817eee87ea86db734.bundle.js"></script>
    
</body>
</html> 